# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- project:
    check:
      jobs:
        - armada-go-docker-build-gate-ubuntu_noble
        - armada-go-airskiff-deployment-noble

    gate:
      jobs:
        - armada-go-docker-build-gate-ubuntu_noble

    post:
      jobs:
        - armada-go-upload-git-mirror
        - armada-go-docker-publish-ubuntu_noble


- nodeset:
    name: armada-go-single-node-noble
    nodes:
      - name: primary
        label: ubuntu-noble

- nodeset:
    name: armada-go-single-node-jammy
    nodes:
      - name: primary
        label: ubuntu-jammy

- job:
    name: armada-go-airskiff-deployment-noble
    description: |
      Deploy Memcached using Airskiff and submitted Armada-go changes.
    parent: treasuremap-airskiff-infra-deploy-base
    nodeset: treasuremap-airskiff-1node-ubuntu_noble
    required-projects:
      - name: airship/treasuremap
        override-checkout: v1.9
    vars:
      treasuremap_ref: v1.9
      CLONE_ARMADA_GO: false
      MAKE_ARMADA_GO_IMAGES: true
      USE_ARMADA_GO: true
      DISTRO: ubuntu_noble
      DOCKER_REGISTRY: localhost:5000
      gate_scripts_relative_path: ../../airship/treasuremap

- job:
    name: armada-go-docker-build-gate-ubuntu_noble
    timeout: 3600
    run: tools/gate/playbooks/docker-image-build.yaml
    nodeset: armada-go-single-node-noble
    vars:
      publish: false
      distro: ubuntu_noble
      tags:
        dynamic:
          patch_set: true

- job:
    name: armada-go-docker-publish-ubuntu_noble
    timeout: 3600
    run: tools/gate/playbooks/docker-image-build.yaml
    nodeset: armada-go-single-node-noble
    secrets:
      - airship_armada_go_quay_creds_2026
    vars:
      publish: true
      distro: ubuntu_noble
      tags:
        dynamic:
          branch: true
          commit: true
        static:
          - latest

- secret:
    name: airship_armada_go_quay_creds_2026
    data:
      username: !encrypted/pkcs1-oaep
        - bU+eVVz84meV9S5PdjmuhE7Hk3CuYdn6Ewr1A+qboTH+Jil2DYmfK4v70K9J7SiepfZ2d
          0thpgiqcH+7MDMLCbJuGbUxiP3eXKtLH36gwggtnNkaTNkhGWd2roe06j8pTxEcp0tSi1
          d0hKBoL02Pnn/qio7fGrCqXRGs/bP5B8U0xmERkQjsN0mKnFpBeUi7gY9+WnLGYX9nVlA
          fVxYl4Vo1xs4SaIQUim3HrXVur4512UkRWUPCMC4pqff3mkfECY4oU+yqMUG0KN5R8YhD
          I2GEvVljaVzlnZthRCn0QY0VymFHQkEJd5BgVB0hexh6fLdYUbx5KPgD/rJU4nJOTdens
          akrD7Ds5gjs+fA/Qy/QwcjtMq4tJPVmjzuXN1m+7EtN9PpJbHI0SwPztpRrfUxp7RGFc1
          z8Cr3FHEukzF5gHqZSTyuHptJrQpqhvJi9ELj4MIcRqqaMGWZuDR6harvBTZGxRgOv4fP
          bWNDsEyPto1dBUxHdYfrGKT+XY4whT3pY19V/1ZhnUFmj/DQjpQTIGABtVm5tmelShl90
          b9VKRKnT4T5f972U34KAAoWeUCdk+Q/+COoIWIYPN+mKunYNWjNAL/zn9KEAz9ZmYhz6Q
          R7IXJp2E60sN4tsJwDiLALKRSZP0WK1svpCzCuz28upoHxDxNjoJIMB2KqBLAs=
      password: !encrypted/pkcs1-oaep
        - I/kkSJG7gEF0FgFBrVAcwhXRM/3Y+PaPRVjCpJBe+iWrhYcTj1aRvtpQ6PW3b7PVYuWfb
          nh3c0YGNqkFXuem2axFAuP2Sm4q/AIbLpavHFah6SKQwB67GQU4Y5GxFjw17TsJTvbALJ
          y3i+9z6UXwmSN2Fz7I8TcdrAV8gXv7W/xdKJdgQwJMP+B3PQbpwHCRBfvgNn2oThzg3Xd
          7k3q2At3JhggdOl1CgN3YxzAjCv6aAFazWLmRi7xoGaD06YZcx+Nm2h5WDNM6XgpJkTii
          oF5Fpv0ZG9wm2xsDq8v5VDp8l+s7IIAkfZBFGid/oru4oLPdgkd/m2bYgL2Jb9AUfA/Sg
          oeuhsTLu2zbCO/u1lEMK5hiqtK3wgd0vWD0iV/ocUegHl183kyHQL76qKow80YgSvsqPn
          7YEJlqxgzbJgHUI57nsqPHLDDHBXChHywc1S7bkLKAYgDHQDca8Zv6Eoy2H9xT1vxIp8e
          RTTY6X93KdMcKILiqKzeax8lHcxa3cIYyYvofxkrMrAro+SUGTwgOTiNJUajx7FNpx0L2
          w1N0QJFC6RzcP1XrLSSi6VJvou3Y2eYihjLIrpqa1E47Cr1OwHMyhBkQgQ2KZ11b5keLM
          WfrNRafsLiYOj2Ztpm+gr9bhYsFRliE8ZLcUkaW+5JKr2mkkMNeORnA0WsXR4c=

- job:
    name: armada-go-upload-git-mirror
    parent: upload-git-mirror
    description: Mirrors airship/armada-go to airshipit/armada-go
    vars:
      git_mirror_repository: airshipit/armada-go
    secrets:
      - name: git_mirror_credentials
        secret: armada-go-airshipit-github-ed25519-secret-2026-01-13
        pass-to-parent: true

- secret:
    name: armada-go-airshipit-github-ed25519-secret-2026-01-13
    data:
      user: git
      host: github.com
      host_key: github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
      ssh_key: !encrypted/pkcs1-oaep
        - P5GpdUZAN4d3+/faH6QRvByGZc5vqhj1+zg9WOwjO5Py2y0w20hrTr/GX+sCNnAffVh52
          3SPD3ehxH3dUaKDO1ljjhCzDPo7BGXh2zr43M2gHz8OFTsApVUqp7XzpeKWypZDtPol/B
          jfZepO5HIHkq0FzTH9yqxD826CPjpbBCU/PDdbZ1t8imZmI9V/OGm044nG5fk5O859qPQ
          LZxvz0lCHnkFit9EW4AH8CQYcMThBqxLr/8MO7eT+vkopoOGLjqW86goJK+PiruOwNP5r
          N6o7fyo0TyNCy8ttpHmm8/8BeXH11TaMsBaoNqp2SUm4yqBWRRvKd0xsFjfgNZWL+Ia6Q
          Qni5KEYkE8kICbD/LlM1kUmwnUe+FXLdtjm00ePwMzlA/21gqwxCASG6RZpzMc8aEwg/Q
          2E+cGpirtM5kSFz281LsZeJ0hhhD3jKtjoXmhwyD6+XuP6peQMazZVYWQ6rvGtmhyinWy
          7OzzuXp4lgmQq6wo4S0uxO8a4U6xyDm4vdxEGV1AcouNW1NvOp03ETpML1mOTgU5GfUPi
          uXhQJBpVcOnB0bSzstmats2VVrXjYeZWoWDnoAzMyma3X5eY+SVExLYofmHS/i0W84c9u
          JdyAPHQKpNlbW3S+RAdzsSdWrcD3moXZDglLnQCPTFHtUZMvvoLf6M7zg9lb24=
